<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Over Studio - Enhanced</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #0f0f0f;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }

    h1 {
      color: #1db954;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #1c1c1c;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px black;
    }

    input, button, select {
      margin: 0.5rem 0;
      padding: 0.6rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
    }

    input[type="file"] {
      background: white;
      color: #000;
    }

    button {
      background: #1db954;
      color: white;
      cursor: pointer;
    }

    video, audio {
      width: 100%;
      margin-top: 1rem;
    }

    .controls, .trim-section, .edit-buttons {
      margin-top: 1rem;
    }

    .section-title {
      margin-top: 2rem;
      font-size: 1.3rem;
      color: #ffdd57;
    }

    .slider {
      width: 200px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üéôÔ∏è Voice Over Studio - Editor</h1>

  <!-- Upload -->
  <div>
    <h2>üìÅ Upload Audio or Video</h2>
    <input type="file" id="mediaInput" accept="audio/*,video/*">
    <div id="mediaContainer"></div>
  </div>

  <!-- Media Controls -->
  <div class="controls">
    <button onclick="playMedia()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseMedia()">‚è∏Ô∏è Pause</button>
    <label>üîä Volume</label>
    <input type="range" min="0" max="1" step="0.01" value="1" onchange="changeVolume(this)" class="slider">
    <label>‚ö° Speed</label>
    <select onchange="changeSpeed(this)">
      <option value="0.5">0.5x</option>
      <option value="1" selected>1x</option>
      <option value="1.5">1.5x</option>
      <option value="2">2x</option>
    </select>
  </div>

  <!-- Trim -->
  <div class="trim-section">
    <div class="section-title">‚úÇÔ∏è Trim Audio (Optional)</div>
    <label>Start (sec): <input type="number" id="trimStart" min="0" value="0"></label>
    <label>End (sec): <input type="number" id="trimEnd" min="0" value="0"></label>
    <button onclick="trimMedia()">Apply Trim</button>
  </div>

  <!-- Voice Over Recording -->
  <div class="section-title">üéôÔ∏è Record Your Voice Over</div>
  <div>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop</button>
    <div id="recordingStatus">üé§ Not recording</div>
    <audio id="voicePlayback" controls></audio>
  </div>

  <!-- Editing Options -->
  <div class="edit-buttons">
    <div class="section-title">üõ†Ô∏è Export / Download</div>
    <button onclick="downloadVoice()">‚¨áÔ∏è Download Voice Over</button>
    <button onclick="alert('This requires a backend to merge audio.')">üîÄ Merge with Video (Coming Soon)</button>
  </div>
</div>

<audio id="audioElement" style="display:none;"></audio>

<script>
  const mediaInput = document.getElementById("mediaInput");
  const mediaContainer = document.getElementById("mediaContainer");
  const recordingStatus = document.getElementById("recordingStatus");
  const voicePlayback = document.getElementById("voicePlayback");
  const audioElement = document.getElementById("audioElement");

  let mediaTag;
  let mediaRecorder;
  let audioChunks = [];

  // Load uploaded media
  mediaInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    const url = URL.createObjectURL(file);
    const isVideo = file.type.startsWith("video");

    mediaContainer.innerHTML = isVideo
      ? `<video id="mediaTag" controls src="${url}"></video>`
      : `<audio id="mediaTag" controls src="${url}"></audio>`;

    mediaTag = document.getElementById("mediaTag");
  });

  function playMedia() {
    if (mediaTag) mediaTag.play();
  }

  function pauseMedia() {
    if (mediaTag) mediaTag.pause();
  }

  function changeVolume(slider) {
    if (mediaTag) mediaTag.volume = slider.value;
  }

  function changeSpeed(select) {
    if (mediaTag) mediaTag.playbackRate = parseFloat(select.value);
  }

  function trimMedia() {
    const start = parseFloat(document.getElementById("trimStart").value);
    const end = parseFloat(document.getElementById("trimEnd").value);

    if (mediaTag && !isNaN(start) && !isNaN(end) && end > start) {
      mediaTag.currentTime = start;
      mediaTag.ontimeupdate = () => {
        if (mediaTag.currentTime >= end) {
          mediaTag.pause();
          mediaTag.ontimeupdate = null;
        }
      };
      mediaTag.play();
    }
  }

  async function startRecording() {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    audioChunks = [];
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();
    recordingStatus.textContent = "üî¥ Recording...";
    mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
    mediaRecorder.onstop = () => {
      const blob = new Blob(audioChunks, { type: 'audio/webm' });
      voicePlayback.src = URL.createObjectURL(blob);
      voicePlayback.dataset.bloburl = voicePlayback.src;
      recordingStatus.textContent = "‚úÖ Recording Stopped";
    };
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === "recording") {
      mediaRecorder.stop();
    }
  }

  function downloadVoice() {
    if (!voicePlayback.dataset.bloburl) return alert("Please record something first.");
    const a = document.createElement('a');
    a.href = voicePlayback.dataset.bloburl;
    a.download = "voice-over.webm";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
</script>

</body>
</html>
